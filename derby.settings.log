CONNECT 'jdbc:derby:bookstore;create=true';
CONNECT 'jdbc:derby:bookstore';
CREATE TABLE APP.BOOKS
(
    ID INT NOT NULL GENERATED ALWAYS AS IDENTITY CONSTRAINT BOOKS_PK PRIMARY KEY,
    NAME VARCHAR(100) NOT NULL,
    PUBLICATION_DATE DATE NOT NULL,
    CONSTRAINT UNIQUE_VALUES UNIQUE (NAME, PUBLICATION_DATE, PRICE)
);
CREATE TABLE APP.AUTHORS
(
    ID INT NOT NULL GENERATED ALWAYS AS IDENTITY CONSTRAINT AUTHORS_PK PRIMARY KEY,
    NAME VARCHAR(100) NOT NULL,
    BIRTH_DATE DATE NOT NULL,
    DEATH_DATE DATE,
    UNIQUE (NAME, BIRTH_DATE)
);
CREATE TABLE APP.AUTHORITY
(
    ID INT NOT NULL GENERATED ALWAYS AS IDENTITY CONSTRAINT AUTHORITY_PK PRIMARY KEY,
    BOOK_ID INT NOT NULL,
    AUTHOR_ID INT NOT NULL,
    CONSTRAINT AUTHOR_FK
    FOREIGN KEY (AUTHOR_ID)
    REFERENCES AUTHORS (ID),
    CONSTRAINT BOOK_FK
    FOREIGN KEY (BOOK_ID)
    REFERENCES BOOKS (ID),
    CONSTRAINT UNIQUE_ID_BIND
    UNIQUE (AUTHOR_ID, BOOK_ID)
);

CREATE VIEW BOOKSTORE_VIEW (AUTHOR_ID, AUTHOR_NAME, AUTHOR_BIRTH_DATE, AUTHOR_DEATH_DATE,
    BOOK_ID, BOOK_NAME, BOOK_PRICE, BOOK_PUBLICATION_DATE) AS
  SELECT
    AUTHORS.ID,
    AUTHORS.NAME,
    AUTHORS.BIRTH_DATE,
    AUTHORS.DEATH_DATE,
    BOOKS.ID,
    BOOKS.NAME BNAME,
    BOOKS.PRICE,
    BOOKS.PUBLICATION_DATE
  FROM AUTHORS
    JOIN AUTHORITY ON AUTHORS.ID = AUTHORITY.AUTHOR_ID
    JOIN BOOKS ON BOOKS.ID = AUTHORITY.BOOK_ID;



SELECT AUTHORS.NAME, BOOKS.NAME from
    AUTHORS INNER JOIN AUTHORITY
        ON AUTHORS.ID = AUTHORITY.AUTHOR_ID
        INNER JOIN BOOKS
            ON BOOKS.ID = AUTHORITY.BOOK_ID
WHERE BIRTH_DATE > '1960-01-01' and YEAR(BOOKS.PUBLICATION_DATE) < 2010

